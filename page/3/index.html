<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="秀才">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="秀才">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="秀才">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>秀才</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">秀才</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/Awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/Awk/" itemprop="url">Awk</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-26T10:19:36+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>参见<a href="http://man.linuxde.net/awk" target="_blank" rel="noopener">linux手册awk部分</a></p>
</blockquote>
<h1 id="示例文本"><a href="#示例文本" class="headerlink" title="示例文本"></a>示例文本</h1><p>test.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Beth	4.00	0</span><br><span class="line">Dan	3.75	0</span><br><span class="line">kathy	4.00	10</span><br><span class="line">Mark	5.00	20</span><br><span class="line">Mary	5.50	22</span><br><span class="line">Susie	4.25	18</span><br></pre></td></tr></table></figure></p>
<h1 id="基本语法示例"><a href="#基本语法示例" class="headerlink" title="基本语法示例"></a>基本语法示例</h1><p><code>awk &#39;$3 &gt;0 { print $1, $2 * $3 }&#39; emp.data</code></p>
<h1 id="通过awk脚本文件"><a href="#通过awk脚本文件" class="headerlink" title="通过awk脚本文件"></a>通过awk脚本文件</h1><p>test.awk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/.+th/ &#123;</span><br><span class="line">    print $0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ awk -f test.awk test.txt</span><br><span class="line"># 结果：</span><br><span class="line">Beth    4.00    0</span><br><span class="line">kathy   4.00    10</span><br></pre></td></tr></table></figure></p>
<h1 id="BEGIN与END"><a href="#BEGIN与END" class="headerlink" title="BEGIN与END"></a>BEGIN与END</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    print &quot;begin search&quot;</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    print &quot;all end&quot;</span><br><span class="line">&#125;</span><br><span class="line">/.+th/&#123;</span><br><span class="line">    print $0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk -f test.awk test.txt</span><br><span class="line"># 结果</span><br><span class="line">begin search</span><br><span class="line">Beth    4.00    0</span><br><span class="line">kathy   4.00    10</span><br><span class="line">all end</span><br></pre></td></tr></table></figure></p>
<h1 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h1><h2 id="ARGC"><a href="#ARGC" class="headerlink" title="ARGC"></a>ARGC</h2><p>表示在命令中提供的参数的个数<br>例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;BEGIN &#123;print &quot;Arguments =&quot;, ARGC&#125;&apos; One Two Three Four</span><br></pre></td></tr></table></figure></p>
<p>结果：<code>Arguments = 5</code></p>
<h2 id="ARGV"><a href="#ARGV" class="headerlink" title="ARGV"></a>ARGV</h2><p>这个变量表示存储命令行输入参数的数组,数组的有效索引是从 0 到 ARGC-1<br>例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    for (i = 0; i &lt; ARGC ;i++)&#123;  </span><br><span class="line">        printf &quot;ARGV[%d]=%s\n&quot;, i, ARGV[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    print &quot;all end&quot;</span><br><span class="line">&#125;</span><br><span class="line">/.+th/&#123;</span><br><span class="line">    print $0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ awk -f test.awk test.txt</span><br><span class="line"># 结果</span><br><span class="line">ARGV[0]=awk</span><br><span class="line">ARGV[1]=test.txt</span><br><span class="line">Beth    4.00    0</span><br><span class="line">kathy   4.00    10</span><br><span class="line">all end</span><br></pre></td></tr></table></figure></p>
<h2 id="ENVISON环境变量"><a href="#ENVISON环境变量" class="headerlink" title="ENVISON环境变量"></a>ENVISON环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    for (n in ENVIRON)&#123;</span><br><span class="line">        print n &quot;: &quot; ENVIRON[n]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ awk -f test.awk test.txt</span><br><span class="line"># 结果</span><br><span class="line">GOROOT: /usr/local/Cellar/go/1.7.4_1/libexec</span><br><span class="line">LESS: -R</span><br><span class="line">PAGER: less</span><br><span class="line">AWKPATH: .:/usr/local/Cellar/gawk/4.1.4_1/share/awk</span><br><span class="line">OLDPWD: ...</span><br><span class="line">TERM_PROGRAM: iTerm.app</span><br></pre></td></tr></table></figure></p>
<h2 id="FILENAME"><a href="#FILENAME" class="headerlink" title="FILENAME"></a>FILENAME</h2><p>文件名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    print FILENAME</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    print FILENAME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/chimps/linux/awk awk -f test.awk test.txt</span><br><span class="line"></span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure></p>
<p>可以看出在begin的时候FILENAME变量为空值</p>
<h2 id="FS"><a href="#FS" class="headerlink" title="FS"></a>FS</h2><p>此变量表示输入的数据域之间的分隔符，其默认值是空格。 你可以使用 -F 命令行选项改变它的默认值。</p>
<h2 id="NF"><a href="#NF" class="headerlink" title="NF"></a>NF</h2><p>此变量表示当前输入记录中域的数量<br>test.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Marks</span><br><span class="line">Mark	5.00</span><br><span class="line">Mary	5.50	22</span><br><span class="line">Susie	4.25	18</span><br></pre></td></tr></table></figure></p>
<p>test.awk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NF&gt;2&#123;</span><br><span class="line">    print $0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/chimps/linux/awk awk -f test.awk test.txt</span><br><span class="line">Mary	5.50	22</span><br><span class="line">Susie	4.25	18</span><br></pre></td></tr></table></figure></p>
<h2 id="NR（FNR）"><a href="#NR（FNR）" class="headerlink" title="NR（FNR）"></a>NR（FNR）</h2><p>默认的就是读取的数据行数，NR可以理解为Number of Record的缩写,FNR则为File Number of Record<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># class1:</span><br><span class="line">zhaoyun 85 87</span><br><span class="line">guanyu 87 88</span><br><span class="line">liubei 90 86</span><br><span class="line"># class2:</span><br><span class="line">caocao 92 87 90</span><br><span class="line">guojia 99 96 92</span><br><span class="line"># test.awk:</span><br><span class="line">&#123;</span><br><span class="line">    print NR,FNR,$0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/chimps/linux/awk awk -f test.awk class1 class2</span><br><span class="line">1 1 zhaoyun 85 87</span><br><span class="line">2 2 guanyu 87 88</span><br><span class="line">3 3 liubei 90 86</span><br><span class="line">4 1 caocao 92 87 90</span><br><span class="line">5 2 guojia 99 96 92</span><br></pre></td></tr></table></figure></p>
<h1 id="数组操作"><a href="#数组操作" class="headerlink" title="数组操作"></a>数组操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    arr[1] = &quot;zhangsan&quot;</span><br><span class="line">    arr[&quot;lisi&quot;] = &quot;lisi&quot;</span><br><span class="line">    arr[2] = &quot;wangwu&quot;</span><br><span class="line"></span><br><span class="line">    for (n in arr)&#123;</span><br><span class="line">        print arr[n]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/chimps/linux/awk awk -f test.awk test.txt</span><br><span class="line">lisi</span><br><span class="line">zhangsan</span><br><span class="line">wangwu</span><br></pre></td></tr></table></figure></p>
<h2 id="判断数组中是否存在某一项"><a href="#判断数组中是否存在某一项" class="headerlink" title="判断数组中是否存在某一项"></a>判断数组中是否存在某一项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    arr[&quot;zhangsan&quot;] = &quot;wangwu&quot;</span><br><span class="line">    if(&quot;zhangsan&quot; in arr)&#123;</span><br><span class="line">        print &quot;zhangsan ok&quot;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        print &quot;zhangsan not found&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(&quot;lisi&quot; in arr)&#123;</span><br><span class="line">        print &quot;lisi ok&quot;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        print &quot;lisi not found&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/chimps/linux/awk awk -f deal_err.awk</span><br><span class="line">zhangsan ok</span><br><span class="line">lisi not found</span><br></pre></td></tr></table></figure></p>
<h1 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h1><h2 id="获取每个进程的内存占用"><a href="#获取每个进程的内存占用" class="headerlink" title="获取每个进程的内存占用"></a>获取每个进程的内存占用</h2><p>test.awk:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NR != 1 &amp;&amp; $4 &gt; 0&#123;</span><br><span class="line">    mem[$4] = $11</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    asorti(mem, Nmem)</span><br><span class="line">    for (k in Nmem)&#123;</span><br><span class="line">        print mem[Nmem[k]], Nmem[k]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><code>ps aux | awk -f test.awk</code></p>
<h2 id="多行日志处理"><a href="#多行日志处理" class="headerlink" title="多行日志处理"></a>多行日志处理</h2><p>file.log：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[2017-02-17 16:19:04] [285]</span><br><span class="line">&lt;- /v2/api/file/item/476</span><br><span class="line">-&gt; &#123;&quot;success&quot;:true,&quot;successInfo&quot;:&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">[2017-03-10 11:57:42] []</span><br><span class="line">&lt;- /v2/api/file/diff?fid1=381&amp;fid2=287</span><br><span class="line">-&gt; &#123;&quot;success&quot;:false,&quot;errorInfo&quot;:&quot;长度不能为空&quot;,&quot;successInfo&quot;:&#123;&#125;,&quot;debug&quot;:&#123;&quot;line&quot;:37,&quot;info&quot;:null&#125;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h3 id="方式一：使用数组"><a href="#方式一：使用数组" class="headerlink" title="方式一：使用数组"></a>方式一：使用数组</h3><p>deal_err.awk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    sub_index = 0</span><br><span class="line">&#125;</span><br><span class="line">/^\[/&#123;</span><br><span class="line">    arr_line[sub_index] = $1 &quot;\t&quot; $2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/^&lt;-/&#123;</span><br><span class="line">    arr_line[sub_index] = arr_line[sub_index] &quot;\t&quot; $2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/^-&gt;/&#123;</span><br><span class="line">    text = substr($2, 2, length($2)-2)</span><br><span class="line">    split(text, text_arr, &quot;,&quot;)</span><br><span class="line">    split(text_arr[1], text_arr1, &quot;:&quot;)</span><br><span class="line">    if (text_arr1[2] == &quot;false&quot;)&#123;</span><br><span class="line">        arr[sub_index] = arr_line[sub_index] &quot;\t&quot; text_arr[2]</span><br><span class="line">        sub_index ++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END&#123;</span><br><span class="line">    for (k in arr) &#123;</span><br><span class="line">        print k,arr[k] &gt;&gt; &quot;output.txt&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f deal_err.awk file.log</span><br></pre></td></tr></table></figure></p>
<h3 id="方式二：匹配成功就写到文件"><a href="#方式二：匹配成功就写到文件" class="headerlink" title="方式二：匹配成功就写到文件"></a>方式二：匹配成功就写到文件</h3><p>deal_err.awk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/^\[/&#123;</span><br><span class="line">    url = $1 &quot;\t&quot; $2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/^&lt;-/&#123;</span><br><span class="line">    request = arr_line[sub_index] &quot;\t&quot; $2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/^-&gt;/&#123;</span><br><span class="line">    response = substr($2, 2, length($2)-2)</span><br><span class="line">    split(response, res_arr, &quot;,&quot;)</span><br><span class="line">    split(res_arr[1], res_arr1, &quot;:&quot;)</span><br><span class="line">    if (res_arr1[2] == &quot;false&quot;)&#123;</span><br><span class="line">        print url,request,res_arr[2] &gt; &quot;output.txt&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很明显，这样可读性好一些<br>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f deal_err.awk file.log</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/expect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/expect/" itemprop="url">expect交互编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-16T10:19:36+08:00">
                2017-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu：apt-get install expect</span><br><span class="line">mac: brew install homebrew/dupes/expect</span><br></pre></td></tr></table></figure>
<h1 id="设置变量"><a href="#设置变量" class="headerlink" title="设置变量"></a>设置变量</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set password  rootddd</span><br></pre></td></tr></table></figure>
<h1 id="获取参数"><a href="#获取参数" class="headerlink" title="获取参数"></a>获取参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set filename [lindex $argv 0]</span><br></pre></td></tr></table></figure>
<h1 id="一般格式"><a href="#一般格式" class="headerlink" title="一般格式"></a>一般格式</h1><blockquote>
<p>开头一定要是expect<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/expect</span><br><span class="line"></span><br><span class="line">set filename [lindex $argv 0]</span><br><span class="line">set password  example_pass</span><br><span class="line"># 开始执行命令</span><br><span class="line">spawn ssh root@example.com</span><br><span class="line"># 匹配（如果包含，则执行下面的send）</span><br><span class="line">expect &quot;password:&quot;</span><br><span class="line"># \r回车</span><br><span class="line">send &quot;$password\r&quot;</span><br><span class="line">send &quot;ls\r&quot;</span><br><span class="line">send &quot;exit\r&quot;</span><br><span class="line"># 结束标志</span><br><span class="line">interact</span><br></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/pdf处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/pdf处理/" itemprop="url">pdf处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-06T10:19:36+08:00">
                2017-09-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>PDFtk 是什么？我觉得官网的一句话解释得很好。</p>
<blockquote>
<p>If PDF is electronic paper, then PDFtk is an electronic staple-remover, hole-punch, binder, secret-decoder-ring, and X-Ray-glasses. PDFtk is a simple tool for doing everyday things with PDF documents.</p>
</blockquote>
<p>其官方网站为：<br><a href="http://www.pdflabs.com/tools/pdftk-the-pdf-toolkit" target="_blank" rel="noopener">官网</a></p>
<p>PDFtk 目前分为三个版本：</p>
<ul>
<li>PDFtk Server：<br>命令行工具。支持 windows、Linux、Mac。</li>
<li>PDFtk Free：<br>图形界面基础免费版；仅限 windows 用户；功能仅限于 PDF 合并和分割；</li>
<li>PDFtk Pro：<br>图形界面专业收费版；仅限 windows 用户，可以对 PDF 文档进行合并、分割、旋转、加水印、加邮戳、加密。</li>
</ul>
<p>对于 Linux 用户，唯一的选择是免费的 PDFtk Server，其功能与收费 PDFtk Pro 完全相同，只是没有 GUI 而已。作者还是很厚道的。</p>
<p>Linux 的各个发行版的官方源中基本都有该软件，直接 apt-get 或者 yum 安装即可。</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>合并 PDF；<br>分割 PDF 页面；<br>旋转 PDF 文档或页面；<br>PDF 解密；（不是破解）<br>PDF 加密；<br>用 X/FDF 填写 PDF 表格；<br>从 PDF 表格中生成 PDF Data Stencils；<br>加背景水印或前景印章；<br>报告 PDF Metrics，书签和元数据；<br>增加 / 更新 PDF 书签或元数据；<br>给 PDF 页面或文档加附件；<br>解压 PDF 附件；<br>分解 PDF 文档为多个单页；<br>解压缩和重压缩页面流；<br>修复受损的 PDF 文档；<br>这功能完全可以与 Adobe Acrobat 相媲美了，更重要的是 PDFtk 支持 Linux 且完全免费。（个人用户免费，若用于商业用途需付费）。</p>
<h1 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h1><p>具体选项看这里：</p>
<p><a href="http://www.pdflabs.com/docs/pdftk-man-page/" target="_blank" rel="noopener">具体选项</a></p>
<p>下面给出一些常见的例子。例子原文</p>
<p>扫描一本书，odd.pdf 为书的全部奇数页，even.pdf 为书的全部偶数页，下面的命令可以将两个 pdf 合并成页码正常的书:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk A=odd.pdf B=even.pdf shuffle A B output collated.pdf</span><br></pre></td></tr></table></figure></p>
<p>如果 odd.pdf 是逆序的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk A=odd.pdf B=even.pdf shuffle Aend-1 B output collated.pdf</span><br></pre></td></tr></table></figure></p>
<p>加密 PDF:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk secured.pdf input_pw foopass output unsecured.pdf</span><br></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，保留全部权限:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk 1.pdf output 1.128.pdf owner_pw foopass</span><br></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，保留全部权限，打开文档需输入密码 “baz”:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk 1.pdf output 1.128.pdf owner_pw foo user_pw baz</span><br></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，打开文档需输入密码 “baz”，保留打印之外的其他权限:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk 1.pdf output 1.128.pdf owner_pw foo user_pw baz allow printing</span><br></pre></td></tr></table></figure></p>
<p>合并 in1.pdf 和 in2.pdf 到新 PDF 中:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in1.pdf in2.pdf cat output out1.pdf</span><br></pre></td></tr></table></figure></p>
<p>或（使用句柄）:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk A=in1.pdf B=in2.pdf cat A B output out1.pdf</span><br></pre></td></tr></table></figure></p>
<p>或（使用通配符）:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk *.pdf cat output combined.pdf</span><br></pre></td></tr></table></figure></p>
<p>去除 in1.pdf 中的第 13 页，并创建 out1.pdf:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf cat 1-12 14-end output out1.pdf</span><br></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk A=in1.pdf cat A1-12 A14-end output out1.pdf</span><br></pre></td></tr></table></figure></p>
<p>对输出进行 40 位加密，撤销所有权限，设置 owner 密码为 foopass:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk 1.pdf 2.pdf cat output 3.pdf encrypt_40bit owner_pw foopass</span><br></pre></td></tr></table></figure></p>
<p>合并两个文件，其中一个需要被加密。对输出不加密:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk A=secured.pdf 2.pdf input_pw A=foopass cat output 3.pdf</span><br></pre></td></tr></table></figure></p>
<p>解压 PDF 页面流，然后就可以在文本编辑器中编辑 PDF 文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk doc.pdf output doc.unc.pdf uncompress</span><br></pre></td></tr></table></figure></p>
<p>压缩 PDF:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk mydoc.pdf output mydoc.clear.pdf compress</span><br></pre></td></tr></table></figure></p>
<p>修复破损的 PDF:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk broken.pdf output fixed.pdf</span><br></pre></td></tr></table></figure></p>
<p>将一个 PDF 文档分割成一页一个文档:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf burst</span><br></pre></td></tr></table></figure></p>
<p>将一个 PDF 文档分割成一页一个文档，并加密，允许低质量的打印:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf burst owner_pw foopass allow DegradedPrinting</span><br></pre></td></tr></table></figure></p>
<p>获取 PDF 问的元数据和书签信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf dump_data output report.txt</span><br></pre></td></tr></table></figure></p>
<p>将 PDF 第一页顺时针旋转 90 度:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf cat 1east 2-end output out.pdf</span><br></pre></td></tr></table></figure></p>
<p>将整个 PDF 文档旋转 180 度:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdftk in.pdf cat 1-endsouth output out.pdf</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/shell/" itemprop="url">shell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-27T10:19:36+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="判断命令是否执行成功"><a href="#判断命令是否执行成功" class="headerlink" title="判断命令是否执行成功"></a>判断命令是否执行成功</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ $? -eq 0 ]];<span class="keyword">then</span> A <span class="keyword">else</span> b;<span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  命令正确的分支</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  命令失败的分支</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h1 id="在脚本中执行其他脚本"><a href="#在脚本中执行其他脚本" class="headerlink" title="在脚本中执行其他脚本"></a>在脚本中执行其他脚本</h1><ul>
<li><p>fork  ( /directory/script.sh)：</p>
<blockquote>
<p>如果shell中包含执行命令，那么子命令并不影响父级的命令，在子命令执行完后再执行父级命令。子级的环境变量不会影响到父级。<br>fork是最普通的, 就是直接在脚本里面用/directory/script.sh来调用script.sh这个脚本.<br>运行的时候开一个sub-shell执行调用的脚本，sub-shell执行的时候, parent-shell还在。<br>sub-shell执行完毕后返回parent-shell. sub-shell从parent-shell继承环境变量.但是sub-shell中的环境变量不会带回parent-shell</p>
</blockquote>
</li>
<li><p>exec (exec /directory/script.sh)：</p>
<blockquote>
<p>执行子级的命令后，不再执行父级命令。<br>exec与fork不同，不需要新开一个sub-shell来执行被调用的脚本.  被调用的脚本与父脚本在同一个shell内执行。但是使用exec调用一个新脚本以后, 父脚本中exec行之后的内容就不会再执行了。这是exec和source的区别</p>
</blockquote>
</li>
<li><p>source (source /directory/script.sh)：</p>
<blockquote>
<p>执行子级命令后继续执行父级命令，同时子级设置的环境变量会影响到父级的环境变量。<br>与fork的区别是不新开一个sub-shell来执行被调用的脚本，而是在同一个shell中执行. 所以被调用的脚本中声明的变量和环境变量, 都可以在主脚本中得到和使用.</p>
</blockquote>
<h1 id="获取时间"><a href="#获取时间" class="headerlink" title="获取时间"></a>获取时间</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_name=&quot;`date +%y%m%d`.sql&quot;</span><br><span class="line"># 结果：170109.sql</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将参数赋值给file_name变量，注意=两边不能有空格</span><br><span class="line">file_name=$1</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/ssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/ssh/" itemprop="url">ssh无密码登录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-15T10:19:36+08:00">
                2017-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ssh无密码登录"><a href="#ssh无密码登录" class="headerlink" title="ssh无密码登录"></a>ssh无密码登录</h1><h2 id="公钥认证的基本思想"><a href="#公钥认证的基本思想" class="headerlink" title="公钥认证的基本思想"></a>公钥认证的基本思想</h2><p>对信息的加密和解密采用不同的key，这对key分别称作private key和public key，其中，public key存放在欲登录的服务器上，而private key为特定的客户机所持有。</p>
<p>当客户机向服务器发出建立安全连接的请求时，首先发送自己的public key，如果这个public key是被服务器所允许的，服务器就发送一个经过public key加密的随机数据给客户机，这个数据只能通过private key解密，客户机将解密后的信息发还给服务器，服务器验证正确后即确认客户机是可信任的，从而建立起一条安全的信息通道。</p>
<p>通过这种方式，客户机不需要向外发送自己的身份标志“private key”即可达到校验的目的，并且private key是不能通过public key反向推断出来的。这避免了网络窃听可能造成的密码泄露。客户机需要小心的保存自己的private key，以免被其他人窃取，一旦这样的事情发生，就需要各服务器更换受信的public key列表。</p>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><ul>
<li><p>用ssh-keygen创建公钥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@Server1 ~]<span class="comment"># ssh-keygen -t rsa</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key(/root/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span>/root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span>/root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">7b:aa:08:a0:99:<span class="built_in">fc</span>:d9:cc:d8:2e:4b:1a:c0:6b:da:e4root@Server1</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+--[ RSA 2048]----+</span></span><br><span class="line"><span class="string">| |</span></span><br><span class="line"><span class="string">| |</span></span><br><span class="line"><span class="string">| |</span></span><br><span class="line"><span class="string">|. |</span></span><br><span class="line"><span class="string">|o. S |</span></span><br><span class="line"><span class="string">|++. . |</span></span><br><span class="line"><span class="string">|+=o. . . |</span></span><br><span class="line"><span class="string">|o+=oB. o |</span></span><br><span class="line"><span class="string">|..E==*... |</span></span><br><span class="line"><span class="string">+-----------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">补充说明</span></span><br><span class="line"><span class="string">ssh-keygen:生成秘钥</span></span><br><span class="line"><span class="string">其中：</span></span><br><span class="line"><span class="string">  -t指定算法</span></span><br><span class="line"><span class="string">  -f 指定生成秘钥路径</span></span><br><span class="line"><span class="string">  -N 指定密码</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看钥匙</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Server1 ~]<span class="comment"># ls -l .ssh  </span></span><br><span class="line">总用量 8  </span><br><span class="line">-rw-------. 1 root root 1675 12月 10 22:20 id_rsa  </span><br><span class="line">-rw-r--r--. 1 root root 394 12月 10 22:20 id_rsa.pub</span><br></pre></td></tr></table></figure>
</li>
<li><p>将公钥复制到被管理机器Server2和Server3下的.ssh目录下（先确保存在这个目录）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 .ssh]<span class="comment"># scp id_rsa.pub root@192.168.1.3:~/.ssh/  </span></span><br><span class="line">The authenticity of host <span class="string">'192.168.1.3(192.168.1.3)'</span> can<span class="string">'t be established.  </span></span><br><span class="line"><span class="string">RSA key fingerprint is93:eb:f9:47:b1:f6:3f:b4:2e:21:c3:d5:ab:1d:ae:65.  </span></span><br><span class="line"><span class="string">Are you sure you want to continueconnecting (yes/no)? yes  </span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>192.168.1.3<span class="string">'(RSA) to the list of known hosts.  </span></span><br><span class="line"><span class="string">root@192.168.1.3'</span>s password:  </span><br><span class="line">id_rsa.pub   </span><br><span class="line">[root@server1 .ssh]<span class="comment"># scp id_rsa.pub root@192.168.1.4:~/.ssh/authorized_keys  </span></span><br><span class="line">The authenticity of host <span class="string">'192.168.1.4(192.168.1.4)'</span> can<span class="string">'t be established.  </span></span><br><span class="line"><span class="string">RSA key fingerprint is93:eb:f9:47:b1:f6:3f:b4:2e:21:c3:d5:ab:1d:ae:65.  </span></span><br><span class="line"><span class="string">Are you sure you want to continueconnecting (yes/no)? yes  </span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>192.168.1.4<span class="string">'(RSA) to the list of known hosts.  </span></span><br><span class="line"><span class="string">root@192.168.1.4'</span>s password:  </span><br><span class="line">id_rsa.pub</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>到Server2和Server3目录下执行下面的命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><p>设置文件和目录权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 authorized_keys</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证使用SSH IP地址的方式无密码访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 .ssh]# ssh 192.168.1.3</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/vim/" itemprop="url">vim</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-05T10:19:36+08:00">
                2017-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="移动光标"><a href="#移动光标" class="headerlink" title="移动光标"></a>移动光标</h2><ul>
<li><code>ctrl+b</code>: 前移一个字符(backward)</li>
<li><code>ctrl+f</code>: 后移一个字符(forward)</li>
<li><code>alt+&lt;-</code>: 前移一个单词</li>
<li><code>alt+-&gt;</code>: 后移一个单词</li>
<li><code>ctrl+a</code>: 移到行首（a是首字母） </li>
<li><code>ctrl+e</code>: 移到行尾（end）</li>
<li><code>ctrl+x</code>: 行首到当前光标替换</li>
</ul>
<h2 id="编辑命令"><a href="#编辑命令" class="headerlink" title="编辑命令"></a>编辑命令</h2><ul>
<li><code>alt+.</code>: 粘帖最后一次命令最后的参数（通常用于<code>mkdir long-long-dir</code>后, <code>cd</code>配合着<code>alt+.</code>）</li>
<li><code>alt+d</code>: 删除当前光标到临近右边单词开始(delete)</li>
<li><code>ctrl+w</code>: 删除当前光标到临近左边单词结束(word)</li>
<li><code>ctrl+h</code>: 删除光标前一个字符（相当于backspace）</li>
<li><code>ctrl+d</code>: 删除光标后一个字符（相当于delete）</li>
<li><code>ctrl+u</code>: 删除光标左边所有</li>
<li><code>ctrl+k</code>: 删除光标右边所有</li>
<li><code>ctrl+l</code>: 清屏</li>
<li><code>ctrl+shift+c</code>: 复制（相当于鼠标左键拖拽）</li>
<li><code>ctrl+shift+v</code>: 粘贴（相当于鼠标中键）</li>
</ul>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li><code>ctrl+n</code>: 下一条命令</li>
<li><code>ctrl+p</code>: 上一条命令</li>
<li><code>alt+n</code>: 下一条命令（例如输入<code>ls</code>, 然后按’alt+n’, 就会找到历史记录下的<code>ls</code>命令）</li>
<li><code>alt+p</code>: 上一条命令（跟<code>alt+n</code>相似）</li>
<li><code>shift+PageUp</code>: 向上翻页</li>
<li><code>shift+PageDown</code>: 向下翻页</li>
<li><code>ctrl+r</code>: 进入历史查找命令记录， 输入关键字。 多次按返回下一个匹配项</li>
</ul>
<h2 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h2><ul>
<li><code>d</code>: 列出以前的打开的命令</li>
<li><code>j</code>: jump到以前某个目录，模糊匹配</li>
</ul>
<h2 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h2><h3 id="移动光标-1"><a href="#移动光标-1" class="headerlink" title="移动光标"></a>移动光标</h3><ul>
<li><code>b</code>: 向前移动一个单词</li>
<li><code>w</code>: 向后移动一个单词</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li><code>dw</code>: 从当前光标开始删除到下一个单词头</li>
<li><code>de</code>: 从当前光标开始删除到单词尾</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/zsh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/zsh/" itemprop="url">zsh</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-29T10:19:36+08:00">
                2017-07-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>按装oh-my-zsh首先需要安装git<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure></p>
<p>然后安装 zsh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zsh</span><br></pre></td></tr></table></figure></p>
<p>接下来安装 oh-my-zsh：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br></pre></td></tr></table></figure></p>
<p>完成后将shell设置为zsh模式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chsh -s /bin/zsh</span><br></pre></td></tr></table></figure></p>
<h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><p>方法1：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh</span><br></pre></td></tr></table></figure></p>
<p>方法2：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:robbyrussell/oh-my-zsh.git </span><br><span class="line">cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc</span><br></pre></td></tr></table></figure></p>
<p>方法3：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install zsh</span><br></pre></td></tr></table></figure></p>
<p>完成后将shell设置为zsh模式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chsh -s /bin/zsh</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/网络管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/网络管理/" itemprop="url">网络管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-15T10:19:36+08:00">
                2017-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h1><ul>
<li><p>查看端口状况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -apn</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看连接数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 80端口</span><br><span class="line">netstat -nat|grep -i &quot;80&quot;|wc -l</span><br><span class="line">// 已连接上的</span><br><span class="line">netstat -na|grep ESTABLISHED|wc -l</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="ufw"><a href="#ufw" class="headerlink" title="ufw"></a>ufw</h1><p>(端口管理)</p>
<ul>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ufw</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启，默认关闭所有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw enable </span><br><span class="line">sudo ufw default deny</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看端口状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>
</li>
<li><p>新增端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 8080</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw delete allow 8080</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许特定来源的访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.1.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="ssh翻墙"><a href="#ssh翻墙" class="headerlink" title="ssh翻墙"></a>ssh翻墙</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参考：[实战 SSH 端口转发](http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/)</span><br><span class="line">ssh -D &lt;local port&gt; &lt;SSH Server&gt;</span><br><span class="line">例：</span><br><span class="line">ssh -D 7000 root@xbug.site</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/进程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux/进程管理/" itemprop="url">进程管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-01T10:19:36+08:00">
                2017-07-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进程查看"><a href="#进程查看" class="headerlink" title="进程查看"></a>进程查看</h1><h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><ul>
<li><p>常用组合之一 aux        </p>
<blockquote>
<p>查看当前系统所有运行的进程<br>-a     显示前台所有进程<br>-u    显示用户名<br>-x    显示后台进程<br>user： 用户名</p>
<ul>
<li>pid：    进程id PID</li>
<li>%CPU    cpu占用百分比</li>
<li>%MEM    内存占用百分比</li>
<li>VSZ    虚拟内存占用量        KB</li>
<li>RSS    固定内存占有量      kb</li>
<li>tty    登录终端    <ul>
<li>tty1-7 本地终端</li>
<li>1-6 字符 </li>
<li>7图形    pts/0-5 alt+F1-F7                </li>
</ul>
</li>
<li>stat<ul>
<li>S：睡眠    </li>
<li>D：不可唤醒</li>
<li>R：运行</li>
<li>T：停止</li>
<li>Z：僵死</li>
<li>W：进入内存交换    </li>
<li>X：死掉的进程     </li>
<li>&lt;:高优先级    </li>
<li>N：低优先级    </li>
<li>L：被锁进内存    </li>
<li>s：含子进程    </li>
<li>+：位于后台    </li>
<li>l：多线程</li>
</ul>
</li>
<li>start    进程触发时间</li>
<li>time        占用cpu时间</li>
<li>command    进程本身</li>
</ul>
</blockquote>
</li>
<li><p>常用组合之二 -ef</p>
<blockquote>
<ul>
<li>-e 显示所有进程</li>
<li>-f 显示详细信息</li>
<li>-F 显示完整格式的进程信息</li>
<li>-H 以层级结构显示进程信息</li>
</ul>
</blockquote>
</li>
<li>常用组合之三 -efH</li>
<li>常用组合之四 -eo axo<blockquote>
<ul>
<li>o field1,field2…<br>自定义要显示的字段，以逗号分隔<br>常用的field:pid,ni,pri,pcup,stat,comm,tty,ppid<ul>
<li>ni: nice值；（优先级）</li>
<li>pri：priority 优先级；</li>
<li>rtprio:real time piority,实时优先级；<br>例：<code>ps axo pid,pri,comm</code></li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="pgrep-pkill命令"><a href="#pgrep-pkill命令" class="headerlink" title="pgrep pkill命令"></a>pgrep pkill命令</h2><blockquote>
<ul>
<li>英文释义：pgrep, pkill - look up or signal processes based on name and other attributes</li>
</ul>
</blockquote>
</li>
<li>格式：pgrep [options] pattern<ul>
<li>-u uid:effective user(以谁的身份启动的)</li>
<li>-U uid:real user</li>
<li>-t TERMINAL:与指定终端相关的的进程</li>
<li>-l 显示进程名</li>
<li>-a 显示完整格式的进程名</li>
<li>-P 显示进程的子进程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line">ps -aux | grep swoole #找到swoole进程</span><br><span class="line">或者：</span><br><span class="line">ps -efH | grep swoole #找到swoole进程</span><br><span class="line">找到进程号：如2257</span><br><span class="line">pgrep -P 2257</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="uptime（效果和top第一行相同）"><a href="#uptime（效果和top第一行相同）" class="headerlink" title="uptime（效果和top第一行相同）"></a>uptime（效果和top第一行相同）</h2><p>过去1分钟，5分钟，10分钟cpu</p>
<h2 id="pstree-查看进程树"><a href="#pstree-查看进程树" class="headerlink" title="pstree    查看进程树"></a>pstree    查看进程树</h2><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><blockquote>
<ul>
<li>第一行：uptime信息（连敲l命令可开启或关闭第一行）<ul>
<li>系统当前时间</li>
<li>系统持续时间</li>
<li>登录用户，1,5,15分钟之前的平均负载</li>
</ul>
</li>
<li>第二行：进程总数</li>
<li>第三行： CPU占用率        <ul>
<li>us 用户空间</li>
<li>sy 内核空间</li>
<li>ni 调整nice值后，多占用空间</li>
<li>id 空闲时间比例</li>
<li>hi 处理硬件中断所需要时间</li>
<li>si 处理软件中断所需要时间</li>
<li>cs 处理上下文（进程）切换所需要时间</li>
<li>st 虚拟化技术占用的cpu</li>
</ul>
</li>
<li>第四行：内存使用：    <ul>
<li>VSZ 虚拟内存集</li>
<li>RSS 常驻内存集</li>
<li>SHM 共享内存集（share memory）</li>
</ul>
</li>
<li>第五行：swap使用</li>
<li>字段： PID，USER，PR（优先级），NI（nice优先级），VIRT（虚拟内存），RES（物理内存），SHR（），S（状态），%CPU,%MEM(内存占用)，TIME+（系统调用总时间），COMMAND（进程名称）</li>
<li>操作命令        <ul>
<li>M    内存排序</li>
<li>P    CPU排序</li>
<li>T 累计占用CPU时间排序</li>
<li>q    退出</li>
<li>s 修改刷新时间间隔</li>
<li>k 终止指定的命令</li>
</ul>
</li>
<li>选项：<ul>
<li>-d # ;更改刷新时间</li>
<li>-b 以批处理方式显示</li>
<li>-n #；显示多少批次</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="htop-top升级版"><a href="#htop-top升级版" class="headerlink" title="htop top升级版"></a>htop top升级版</h2><blockquote>
<ul>
<li>选项<ul>
<li>-d #:指定延迟时间加载</li>
<li>-u UserName:仅显示指定用户的进程</li>
<li>-s COLUME:以指定字段进行排序</li>
</ul>
</li>
<li>子命令<ul>
<li>l：显示选定的进程打开的文件列表</li>
<li>s：跟踪选定的进程的系统调用</li>
<li>t：以层级结构显示个进程状态</li>
<li>a：将选定的进程绑定至某指定的CPU核心</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h2><blockquote>
<ul>
<li>概要： Report virtual memory statistics</li>
<li>格式： vmstat [options] [delay [count]] </li>
<li>procs <ul>
<li>r：等待运行的进程个数，CPU上等待运行的队列长度</li>
<li>b：处于不可中断睡眠的进程个数，被阻塞的任务队列的长度</li>
</ul>
</li>
<li>memory<ul>
<li>swpd：交换内存使用总量</li>
<li>free：空闲的物理内存总量</li>
<li>buffer：用户buffer的内存总量</li>
<li>cache：用户cache的内存总量</li>
</ul>
</li>
<li>swap（交换分区）<ul>
<li>si：数据进入swap中的数据速率（kb/s）</li>
<li>so：数据离开swap中的数据速率（kb/s）</li>
</ul>
</li>
<li>io<ul>
<li>bi：从设备中读入数据到系统的速度（kb/s）</li>
<li>bo：保存数据到块设备的速率（kb/s）</li>
</ul>
</li>
<li>system<ul>
<li>in：每秒产生的中断次数</li>
<li>cs：每秒产生的上下文切换次数</li>
<li>（上面这2个值越大，会看到由内核消耗的CPU时间会越多）</li>
</ul>
</li>
<li>CPU<ul>
<li>us：用户进程消耗的CPU时间百分比（us 的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超过50% 的使用，那么我们就该考虑优化程序算法或者进行加速了）（user）</li>
<li>sy：内核进程消耗的CPU时间百分比（system）</li>
<li>id：空闲（idle）</li>
<li>wa：IO等待消耗的CPU时间百分比（ wa 的值高时，说明IO等待比较严重，这可能是由于磁盘大量作随机访问造成，也有可能是磁盘的带宽出现瓶颈(块操作)。）（wait）</li>
</ul>
</li>
<li>选项<ul>
<li>-s：显示内存统计数据</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="pmap"><a href="#pmap" class="headerlink" title="pmap"></a>pmap</h2><blockquote>
<ul>
<li>概要：pmap命令用于报告进程的内存映射关系，是Linux调试及运维一个很好的工具。</li>
<li>格式：pmap [options] pid […]</li>
<li>选项<ul>
<li>-x：查看详细信息</li>
</ul>
</li>
<li>另一种查看方式：cat /proc/PID/maps</li>
</ul>
</blockquote>
<h2 id="pidof"><a href="#pidof" class="headerlink" title="pidof"></a>pidof</h2><blockquote>
<ul>
<li>概要：查看pid</li>
<li>示例：<code>pidof nginx</code></li>
</ul>
</blockquote>
<h2 id="dstat"><a href="#dstat" class="headerlink" title="dstat"></a>dstat</h2><blockquote>
<ul>
<li>选项<ul>
<li>-c：显示CPU系统占用，用户占用，空闲，等待，中断，软件中断等信息。 </li>
<li>-C：当有多个CPU时候，此参数可按需分别显示cpu状态，例：-C 0,1 是显示cpu0和cpu1的信息。 </li>
<li>-d：显示磁盘读写数据大小。 </li>
<li>-D hda,total：include hda and total。 </li>
<li>-n：显示网络状态。（network）</li>
<li>-N eth1,total：有多块网卡时，指定要显示的网卡。 </li>
<li>-l：显示系统负载情况。</li>
<li>-m：显示内存使用情况。 </li>
<li>-g：显示页面使用情况。（从内存写入磁盘，从磁盘写入内存）</li>
<li>-p：显示进程状态。(process)</li>
<li>-s：显示交换分区使用情况。(swapped) </li>
<li>-S：类似D/N。 </li>
<li>-r：I/O请求情况。 </li>
<li>-y：系统状态。 </li>
<li>–ipc：显示ipc消息队列，信号等信息。</li>
<li>–socket：用来显示tcp udp端口状态。 </li>
<li>-a：此为默认选项，等同于-cdngy。</li>
<li>-v：等同于 -pmgdsc -D total。 </li>
<li>–tcp</li>
<li>–udp</li>
<li>–raw</li>
<li>–top-cpu：最消耗cpu</li>
<li>–top-io：最消耗磁盘io</li>
<li>–top-mem：最消耗内存</li>
<li>–top-lantency：延迟最大的进程</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2><blockquote>
<ul>
<li>概要：用于向进程发信号，已实现进程的管理（send a signal to a process）</li>
<li>格式：kill(选项)(参数)</li>
<li>每个信号的标示方式有三种  <ul>
<li>信号的数字标识</li>
<li>信号的完整名称</li>
<li>信号的简写名称</li>
</ul>
</li>
<li>向进程发信号<ul>
<li>kill[-s signal|-SIGNAL] pid …</li>
<li>常用信号<ol>
<li>（1号）SIGHUP：无需关闭进程而让其重读配置文件</li>
<li>（2号）SIGINT：终止正在运行的进程，相当于ctrl+c</li>
<li>（9号）SIGKILL：杀死进行中的进程</li>
<li>（15号）SIGTREM：终止运行中的进程</li>
<li>（18号）SIGCONT：继续</li>
<li>（19号）SIGSTOP：停止</li>
</ol>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="killall"><a href="#killall" class="headerlink" title="killall"></a>killall</h2><blockquote>
<ul>
<li>概要：kill processes by name</li>
<li>格式：kill [signal] program</li>
</ul>
</blockquote>
<h2 id="4-进程管理-终止进程"><a href="#4-进程管理-终止进程" class="headerlink" title="4    进程管理        终止进程"></a>4    进程管理        终止进程</h2><pre><code>ps   aux    组合使用
kill  PID        结束单个进程  结束进程
-9  强制         
 pstree
killall  -9   进程名        结束一类进程
pkill    -9   进程名
w            判断登录用户
pkill  -9  -t  终端号    把某个终端登录的用户踢出
pkill  -9  -t tty     把本地登录终端1登录用户踢出
</code></pre><h1 id="2-linux服务管理"><a href="#2-linux服务管理" class="headerlink" title="2    linux服务管理"></a>2    linux服务管理</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><pre><code>1）系统默认安装的服务            
2）源码包安装的服务
</code></pre><p>（一）系统默认安装的服务</p>
<h2 id="确定服务分类"><a href="#确定服务分类" class="headerlink" title="确定服务分类"></a>确定服务分类</h2><pre><code>chkconfig  --list        查看服务的自启动状态
    运行级别：0-6
        0    关机
        1    单用户模式
        2    不完全多用户，不包含NFS服务  无网络登录
        3    完全多用户    字符界面   
        4    未分配
        5    图形界面
        6    重启
        init  0     halt 关机         init 5  startx     init 3
        init  6    重启  init(初始化)
        runlevel            查询系统当前运行级别
        vi  /etc/inittab
</code></pre><h2 id="独立的服务器管理"><a href="#独立的服务器管理" class="headerlink" title="独立的服务器管理"></a>独立的服务器管理</h2><p>1）启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/rc.d/init.d/服务名   start|stop|restart|status</span><br><span class="line">/etc/rc.d/init.d/httpd  start</span><br><span class="line">service   服务名   start|stop|restart|status</span><br></pre></td></tr></table></figure></p>
<p>2)自启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  --level  2345  服务名  on|off</span><br><span class="line">vi  /etc/rc.local----&gt;/etc/rc.d/rc.local</span><br><span class="line">/etc/rc.d/init.d/httpd  start</span><br></pre></td></tr></table></figure></p>
<h2 id="ntsysv"><a href="#ntsysv" class="headerlink" title="ntsysv"></a>ntsysv</h2><pre><code>所有系统默认安装服务都可以使用ntsysv命令进行自启动管理
（二）源码包安装的服务
1源码包安装的服务            
    1）绝对路径启动
        /usr/local/apache2/bin/apachectl  start 
    2)自启动
        vi /etc/rc.local
        /usr/local/apache2/bin/apachectl  start
</code></pre><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>服务管理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">RPM包安装服务</span><br><span class="line">	独立的服务</span><br><span class="line">		启动：	</span><br><span class="line">			/etc/rc.d/init.d/服务名  start</span><br><span class="line">			service  服务名  start</span><br><span class="line"></span><br><span class="line">		自启动：</span><br><span class="line">			chkconfig  --level  2345  服务名  on|off</span><br><span class="line">			vi  /etc/rc.local		推荐</span><br><span class="line">				/etc/rc.d/init.d/httpd  start</span><br><span class="line">源码包服务</span><br><span class="line">	启动</span><br><span class="line">			/usr/local/服务名/bin/服务名二进制执行文件  start</span><br><span class="line">	自启动</span><br><span class="line">			vi  /etc/rc.local</span><br><span class="line">				/usr/local/apache2/bin/apachectl  start</span><br></pre></td></tr></table></figure></p>
<h1 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h1><pre><code>echo  11  &gt;&gt;  /root/aa        在aa文件中追加11.一会定时任务验证用
循环定时任务                        
crontab  -e        编辑定时任务
*  *  *  *  *  命令
10  *  31  *  *  命令
10  *  *  *  *  命令
5  4  *  5,7,10  *  命令
*/10  *  *  *  *  命令
第一个：一小时中第几分钟        0-59
第二个：一天中第几个小时        0-23
第三个：一个月中第几天        1-31
第四个：一年第几个月            1-12
第五个：一周中星期几            0-6        
crontab  -l        查看系统定时任务
crontab  -r          删除定时任务
</code></pre><p>注意事项：</p>
<blockquote>
<p>选项都不能为空，必须填入，不知道的值使用通配符<em>表示任何时间<br>每个时间字段都可以指定多个值，不连续的值用,间隔，连续的值用-间隔<br>间隔固定时间执行书写为</em>/n格式<br>命令应该给出绝对路径<br>   星期几和第几天不能同时出现<br>   最小时间范围是分钟，最大时间范围是月</p>
</blockquote>
<h1 id="查看硬件相关信息："><a href="#查看硬件相关信息：" class="headerlink" title="查看硬件相关信息："></a>查看硬件相关信息：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo 文件保存了CPU设备信息  </span><br><span class="line">dmesg				查看系统启动信息</span><br><span class="line">cat  /var/log/dmesg		系统启动信息日志		</span><br><span class="line">dmesg | grep eth0		查看eth0信息</span><br><span class="line">dmesg | grep CPU		查看cpu信息</span><br></pre></td></tr></table></figure>
<h1 id="进程前后台切换"><a href="#进程前后台切换" class="headerlink" title="进程前后台切换"></a>进程前后台切换</h1><h2 id="前后台切换"><a href="#前后台切换" class="headerlink" title="前后台切换"></a>前后台切换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">command &amp;   //将进程放在后台执行</span><br><span class="line">ctrl-z      //暂停当前进程 并放入后台</span><br><span class="line">jobs        //查看当前后台任务</span><br><span class="line">bg          //将任务转为后台执行</span><br><span class="line">fg          //将任务调回前台</span><br><span class="line">kill        //杀掉任务</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果我们在终端中直接运行一GUI程序，一般情况下，终端就会被当前进程占用了。如果我们想把它放到后台运行有两种方法：</p>
<ol>
<li>command &amp; 在运行的命令后加一个&amp;号，就会后台运行命令</li>
<li>ctrl-z 在终端中按ctrl-z 会将当前任务暂停并转入后台; 利用jobs命令可以查看当前后台的任务; 如果在jobs命令后增加 -l 参数 那么就会显示详细信息!</li>
<li>可以发现终止的进程状态为Stopped 通过bg %i （i为进程的标号）命令可以将其转为运行</li>
<li>如果想要结束任务，可以利用kill %i命令</li>
<li>示例图：<img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce54" alt="title"></li>
</ol>
</blockquote>
<h2 id="改变进程所在进程树的位置"><a href="#改变进程所在进程树的位置" class="headerlink" title="改变进程所在进程树的位置"></a>改变进程所在进程树的位置</h2><ul>
<li>默认情况下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php test_swoole_server.php</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce55" alt="title"></p>
<ul>
<li>改变进程所在位置后<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(php test_swoole_server.php &amp;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce53" alt="title"></p>
<h2 id="Hnohup"><a href="#Hnohup" class="headerlink" title="Hnohup"></a>Hnohup</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(nohup php watch_send_email_websocket.php 2&gt;/root/log/swoole/send_email/error.log &amp;)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mongodb/mongo聚合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秀才">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/mongodb/mongo聚合/" itemprop="url">mongo聚合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-08T10:19:36+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分组统计"><a href="#分组统计" class="headerlink" title="分组统计"></a>分组统计</h1><h2 id="shell语法"><a href="#shell语法" class="headerlink" title="shell语法"></a>shell语法</h2><p>根据等级分组统计<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.users.aggregate([&#123;<span class="string">"$group"</span>:&#123;<span class="string">"_id"</span>:<span class="string">"bookLevel"</span>, <span class="string">"count"</span>:&#123;<span class="string">"$sum"</span>:<span class="number">1</span>&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure></p>
<p>根据引导分组统计<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.users.aggregate([&#123;<span class="string">"$group"</span>:&#123;<span class="string">"_id"</span>:&#123;<span class="string">"guide"</span>:<span class="string">"$guide"</span>, <span class="string">"guideTwo"</span>:<span class="string">"$guideTwo"</span>&#125;, <span class="string">"count"</span>:&#123;<span class="string">"$sum"</span>:<span class="number">1</span>&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure></p>
<h2 id="mgo语法"><a href="#mgo语法" class="headerlink" title="mgo语法"></a>mgo语法</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LevelCount 用户等级分布</span></span><br><span class="line"><span class="keyword">type</span> LevelCount <span class="keyword">struct</span> &#123;</span><br><span class="line">	Level <span class="keyword">int</span> <span class="string">`bson:"_id"`</span></span><br><span class="line">	Count <span class="keyword">int</span> <span class="string">`bson:"count"`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> counts []LevelCount</span><br><span class="line">mongoInstance := db.GetInstance()</span><br><span class="line"><span class="keyword">defer</span> mongoInstance.Close()</span><br><span class="line">collection := mongoInstance.GetCollection(UsersKey)</span><br><span class="line">m := []bson.M&#123;</span><br><span class="line">    &#123;<span class="string">"$group"</span>: bson.M&#123;<span class="string">"_id"</span>: <span class="string">"$bookLevel"</span>, <span class="string">"count"</span>: bson.M&#123;<span class="string">"$sum"</span>: <span class="number">1</span>&#125;&#125;&#125;,</span><br><span class="line">&#125;</span><br><span class="line">err = collection.Pipe(m).All(&amp;counts)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">chimps</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chimps</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
